---
title: "Homeless in USA"
author: "Felipe Alamos"
date: "February 10, 2019"
output:
  html_document:
    code_folding: "hide"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Introduction

Homeless people are one of the most vulnerable and marginalized members of society in the United States of America. According to the McKinney -Vento Homeless Assistance Act of 1987, a person is experiencing a homelessness cogndition whenever she or he is lacking a regular and adequate nighttime residence. It is a particularly harmful state, especially considering that it is usually associated with a variety of other problems in health, education or employment. In the USA, during 2018 there were 552,830 people living in homeless condition.

This portfolio aims to visualize, and hence be able to dimension, the homelessness situation in the USA, in the hope of providing useful information and insights to understand this social phenomenon. Visualizations will consider the number of people in homeless situation (and different homelessness classification) across the different states of the country. In addition, the goal is to provide visual information of other data which may be interesting and possibly associated to this problem, such as resources assigned to emergency housing programs, GDP per state, performance indicators of shelters, etc. The main source of information will be the U.S. Department of Housing and Urban Development (HUD).


We will be mainly using tidyverse library for data manipulation, ggplot2  for visualizations, Simple Features for mapping.

```{r libraries, message=FALSE, warning=FALSE}

library(rmarkdown)
library(tidyverse)
library(plyr)
library(ggplot2)
library(readxl)
library(scales)
library(extrafont)
library(ggrepel)
library(sf)
library("rnaturalearth")


#Declaration of color palletes and themes

#Color pallete we will be using
cols <- c("#1a9641","#a6d96a","#ffffbf","#fdae61","#d7191c") 

homeless_theme <- 
  theme(title = element_text(family="Calibri"),
        plot.title = element_text(size = rel(2)),
        plot.subtitle =element_text(size = rel(1)),
        plot.caption = element_text(family="Georgia"),
        axis.title = element_text(family="Times New Roman"),
        panel.grid = element_line(linetype = 'dashed', colour = "black"),
        panel.grid.major = element_line(size = 0.5),
        panel.grid.minor = element_line(size = 0.1),
        panel.background = element_rect(fill='white')
        )

homeless_map_theme <- 
  homeless_theme %+replace%
    theme(
      axis.title      =   element_blank(),
      axis.text       =   element_blank(),
      axis.ticks       =   element_blank(),
      panel.spacing    =   unit(0,"lines"),
      plot.margin     =   unit(c(0,0,0,0),"lines"),
      panel.background = element_rect(fill='lightblue'),
      complete = TRUE
    )


```

## Homelessness in time 

A first necessary aproach is to quantify the amount of people experiencing homelessness through time. We would like to know if the total amount of homeless has increased, decreased or kept constant during last decade. Same question would be inteteresting for evolution of subpopulations of homeless such as: sheltered and unsheltered, those living in families or alone, etc.

Generally speaking, the total homeless population has had a constant decrease for the last decade. We can observe that from 2012 to 2013 there was a steeper decline. From 2016 to 2018 there has been a slight increase.

```{r, message=FALSE}

#Load data
h_2018 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=2)
h_2017 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=3)
h_2016 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=4)
h_2015 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=5)
h_2014 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=6)
h_2013 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=7)
h_2012 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=8)
h_2011 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=9)
h_2010 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=10)
h_2009 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=11)
h_2008 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=12)
h_2007 <-read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=13)

#Select only useful columns
h_2018<-h_2018 %>% select(1,3,7,8,9,15,25)
h_2017<-h_2017 %>% select(1,3,7,8,9,15,25)
h_2016<-h_2016 %>% select(1,3,7,8,9,15,25)
h_2015<-h_2015 %>% select(1,3,7,8,9,15,25)
h_2014<-h_2014 %>% select(1,3,7,8,9,15,25)
h_2013<-h_2013 %>% select(1,3,7,8,9,15,25)
h_2012<-h_2012 %>% select(1,3,7,8,9,15,25)
h_2011<-h_2011 %>% select(1,3,7,8,9,15,25)
h_2010<-h_2010 %>% select(1,3,7,8,9,15,25)
h_2009<-h_2009 %>% select(1,3,7,8,9,15,25)
h_2008<-h_2008 %>% select(1,3,7,8,9,15,25)
h_2007<-h_2007 %>% select(1,3,7,8,9,15,25)

#Rename column of total number of homeless

names(h_2018) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2017) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2016) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2015) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2014) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2013) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2012) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2011) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2010) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2009) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2008) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")
names(h_2007) <- c("State","Total_homeless","Sheltered","Unsheltered","Alone","In_families","Chronic")

#Select only totals, add year and get only total in country
h_2018<- h_2018 %>% mutate(Year = 2018)%>% tail(1)
h_2017<- h_2017 %>% mutate(Year = 2017)%>% tail(1)
h_2016<- h_2016 %>% mutate(Year = 2016)%>% tail(1)
h_2015<- h_2015 %>% mutate(Year = 2015)%>% tail(1)
h_2014<- h_2014 %>% mutate(Year = 2014)%>% tail(1)
h_2013<- h_2013 %>% mutate(Year = 2013)%>% tail(1)
h_2012<- h_2012 %>% mutate(Year = 2012)%>% tail(1)
h_2011<- h_2011 %>% mutate(Year = 2011)%>% tail(1)
h_2010<- h_2010 %>% mutate(Year = 2010)%>% tail(1)
h_2009<- h_2009 %>% mutate(Year = 2009)%>% tail(1)
h_2008<- h_2008 %>% mutate(Year = 2008)%>% tail(1)
h_2007<- h_2007 %>% mutate(Year = 2007)%>% tail(1)

#Merging all data of years in one data frame
all_years <- rbind.fill(h_2018,h_2017,h_2016,h_2015,h_2014,h_2013,h_2012,h_2011,h_2010,h_2009,h_2008,h_2007)

#Change variable type of total_homeless
all_years <- mutate(all_years, Total_homeless = as.numeric(Total_homeless))
all_years <- mutate(all_years, Unsheltered = as.numeric(Unsheltered))
all_years <- mutate(all_years, Alone = as.numeric(Alone))
all_years <- mutate(all_years, In_families = as.numeric(In_families))
all_years <- mutate(all_years, Chronic = as.numeric(Chronic))
all_years <- mutate(all_years, Sheltered = as.numeric(Sheltered))


#Plotting total n_homeless for different years
homeless_time_plot<-
  ggplot(data=all_years, aes(x=Year, y=Total_homeless))+
  geom_line(linetype = "solid", color=cols[1])+
  geom_point(color=cols[2])+
  scale_y_continuous(name="Number of homeless")+
  scale_x_continuous(breaks = c(2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))+
  labs(title = "Decline of total homeless in USA during\nlast decade",
       subtitle = "Steep decline from  2012-2016. Slight increase in recent years", caption = "Source: U.S. Department of Housing and Urban Development (HUD)",x = "Years")+
  homeless_theme

#Visualize
plot(homeless_time_plot)


```

Now we would like to study evolution in time of different homeless populations. Instead of studying total numbers of populations, we will visualize rates of changes in time:

```{r}

subpopulations <-
  all_years %>%
  select(3,4,5,6,7,8)
  
subpopulations <- gather(subpopulations, key = "Type", value = "Quantity" ,  1:5)

#Plotting total n_homeless for different years
homeless_subgroups_time_plot<-
  ggplot(subpopulations, aes(x=Year, y=log(Quantity), group =Type,colour = Type))+
  geom_line(linetype = "solid")+
  geom_point()+
  scale_y_continuous(name="log(Number of homeless)",labels=comma)+
  scale_x_continuous(breaks = c(2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))+
  labs(title = "Unsheltered, chronic and in families homeless\npresent the biggest rates of decline in last decade",
       subtitle = "Sheltered and individual homeless decline in constante rate", caption = "Source: U.S. Department of Housing and Urban Development (HUD)",x = "Years")+
  homeless_theme+
  scale_color_manual(values = cols)

#Visualize
plot(homeless_subgroups_time_plot)
```

##Homeless Demographics
We present several characteristics of the homeless population. Thanks to the data, we can understand the following:
- Most homeless people are not chronically homeless.
- A significant proportion are individuals alone rather than in families
- There is a significant proportion of Black or African American homeless considering composition of US population
- Although majority are men,there is also a significant amount of woman.
- Most homeless are in an unsheltered condition

```{r, message=FALSE}
#Load data of number of homeless in states
pit_by_state <- read_excel("Data/2007-2018-PIT-Counts-by-State.xlsx", sheet=2)

#Fix columns names
names(pit_by_state)<-make.names(names(pit_by_state),unique = TRUE)

#Get sheltered and unsheltered info
sheltered_unsheltered<- pit_by_state %>% tail(1) %>% select(Sheltered.Total.Homeless..2018, Unsheltered.Homeless..2018)

sh <- sheltered_unsheltered[1][[1]] /(sheltered_unsheltered[1][[1]] + sheltered_unsheltered[2][[1]])

unsh<- sheltered_unsheltered[2][[1]] /(sheltered_unsheltered[1][[1]] + sheltered_unsheltered[2][[1]])

#Get individuals alone/in families
alone_families<- pit_by_state %>% tail(1) %>% select(Homeless.Individuals..2018, Homeless.People.in.Families..2018)

alone <- alone_families[1][[1]] /(alone_families[1][[1]] + alone_families[2][[1]])

families<- alone_families[2][[1]] /(alone_families[1][[1]] + alone_families[2][[1]])

#Get chornic
chornic_temporary<- pit_by_state %>% tail(1) %>% select(Chronically.Homeless..2018, Overall.Homeless..2018
)

chornic_ <- chornic_temporary[1][[1]] /chornic_temporary[2][[1]]
temporary<- 1-chornic_
chornic<-chornic_

#Create dataframe for classifications
c <- matrix(0, ncol = 3, nrow = 0)
classifications <- data.frame(c)
colnames(classifications)<- c("Classification","Quantity","Type")

classifications <- 
  classifications %>% 
  add_row( Classification="Shelter condition", Quantity=sh, Type="Sheltered")%>% 
  add_row( Classification="Shelter condition", Quantity=unsh, Type="Unsheltered")%>%
  add_row( Classification="Family state", Quantity=alone, Type="Individuals alone")%>% 
  add_row( Classification="Family state", Quantity=families, Type="Individuals in families")%>%
  add_row( Classification="Chornic", Quantity=temporary, Type="Temporary")%>%
  add_row( Classification="Chornic", Quantity=chornic, Type="Chornic")%>%
  
  add_row( Classification="Sex", Quantity=0.602, Type="Male")%>%
  add_row( Classification="Sex", Quantity=0.391, Type="Female")%>%
  add_row( Classification="Sex", Quantity=0.007, Type="Other")%>%
  add_row( Classification="Race", Quantity=0.398, Type="Black or African American")%>%
  add_row( Classification="Race", Quantity=0.489, Type="White")%>%
  add_row( Classification="Race", Quantity=0.028, Type="Native American")%>%
  add_row( Classification="Race", Quantity=0.012, Type="Asian")%>%
  add_row( Classification="Race", Quantity=0.061, Type="Other races")

xs <- split(classifications, f=classifications$Classification)

p <- ggplot(xs$Chornic) +
  geom_bar(aes(x=1,y=Quantity,fill = Type), stat="identity")+
  scale_x_discrete(name="")+
  scale_y_continuous(name="Proportion")+
  labs(caption = "Source: U.S. Department of Housing and Urban Development (HUD)")+
  coord_polar("y", start=0)+
  scale_fill_manual(values = cols)+
  homeless_theme#+
#  geom_text(aes(
 #   x=1,
  #  y=ifelse(cumsum(Quantity)=Quantity,0,1),
   # label=sprintf("%1.2f%%", 100*Quantity)))

p1 <- p + labs(title = "Homeless are mostly temporary than chornic", subtitle = "Consistent with theory that homeless is usually not a permanent state")


p2 <- p %+% xs$`Family state`+labs(title = "Most homeless are alone rather\nthan with families", subtitle = "Observations, particularly in streets, is consisten with data")


p3 <- p %+% xs$Race+labs(title = "Black/African american dominant\nrace proportionally to US Population", subtitle = "White race is dominant in absolute values")

p4 <- p %+% xs$Sex+labs(title = "Altough men are more visible,\nWoman is still significant proportion of homeless population", subtitle = "40% are woman")

p5 <- p %+% xs$`Shelter condition`+ labs(title = "Most homeless in shelter condition", subtitle = "These may vary depending on season of year")

plot(p1)
plot(p2)
plot(p3)
plot(p4)
plot(p5)
```

##Homelessness in different states during 2018

We will now compare the amount of homeless between states. NY and HI present severe rates of homeless per capita. 

```{r, warning=F, message=FALSE}

#Do not consider last row of totals
pit_by_state<- pit_by_state %>% head(-1)

#Load data of population in states
population <- read_excel("Data/nst-est2018-01.xlsx", sheet=1, range = "A4:L60")
colnames(population)[colnames(population)=="X__1"] <- "State"
population$State <- sub(".", "", population$State)
population<-tail(population, -5) #Do not consider first elements
population$State <- state.abb[match(population$State, state.name)] #Change to state codes
#population[9,1] = "DC"

#Data frame with homeless population and state population, plus column with homeless every 100,000 citizens
homeless_and_population <- merge(pit_by_state, population, by = "State") %>% mutate(homeless_per_100000 = Overall.Homeless..2018/`2018`*100000)


#Plot states vs n_homeless_per_capita
homeless_per_state_2018_plot<-
  ggplot(data=homeless_and_population, aes(x=reorder(State, -homeless_per_100000), y=homeless_per_100000, fill=homeless_per_100000))+
  geom_bar(stat = "identity")+
  scale_y_continuous(
    name="Number of homeless every 100,000",
    limits=c(0,500),
    breaks = c(0,50,100,200,300,400,500)
    )+
  scale_fill_gradientn(
    colors = cols,
    aesthetics = "fill")+
  theme(
    axis.text.x = element_text(size=7, angle = 90, vjust=-0.001),
    panel.grid.major.x = element_blank())+ #Rotate x axis text
  labs(title = "NY, HI, OR, and CA present highest levels\nof Homeless/capita in U.S. States on 2018",
       subtitle = "Most states with around 50-150 homeles per 100,000 persons",
       caption = "Source: U.S. Department of Housing and Urban Development (HUD)", 
       x = "States")+
  homeless_theme

#Visualize
plot(homeless_per_state_2018_plot)

```

It would now be interesting to have a geographical perspective of the differences between the states

```{r, results='hide', fig.keep='all', warning = F, message = F}
#Load stats shapefile
#Source: https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html
states_shp <- st_read("Data/cb_2017_us_state_500k/cb_2017_us_state_500k.shp")

homeless_and_geog_states <-
  inner_join(states_shp, homeless_and_population, by = c("STUSPS"="State"))

ggplot(data = homeless_and_geog_states) + 
  geom_sf(aes(fill=homeless_per_100000))+
  coord_sf(xlim = c(-124.7844079, -66.9513812), ylim = c(49.3457868, 24.7433195), expand = FALSE)+
  scale_fill_gradientn(colors = cols, aesthetics = "fill")+
  geom_text(#Could use geom_text_repel, but shows many ugly useless lines
    aes(label = STUSPS, geometry = geometry),
    size=3,
    stat = "sf_coordinates",
    #min.segment.length = 0
  )+
  labs(title = "High proportion of homeless per capita presented\nin west coast states + NY",       subtitle = "Rest of the country presents small deviations", caption = "Source: Source: U.S. HUD")+
  homeless_map_theme


```

##Homelessness and GDP
During the following study we will try to understand if rich states experience more or less homelessness. Generally speaking, we can see that there is no trend.


```{r, message=FALSE, warning=FALSE}

#Load data of GDP per states
gdp_state <- read_excel("Data/qgdpstate1118.xlsx", sheet=4, range = "A5:H64")
colnames(gdp_state)[colnames(gdp_state)=="X__1"] <- "State"
colnames(gdp_state)[colnames(gdp_state)=="Q2__1"] <- "GDP"

#Remove weird dots
gdp_state$State <- sapply(gdp_state$State, function(x)
  iconv(x, from = 'UTF-8', to = 'ASCII//TRANSLIT'))

gdp_state$State <- sapply(gdp_state$State, function(x)gsub("\\.","",x))
gdp_state$State <- sapply(gdp_state$State, function(x)gsub(" $","",x, perl = T))

#Clean unimportant rows
gdp_state <- gdp_state %>% subset(State!="United States")%>%   
  subset(State!="United States")%>%
  subset(State!="New England")%>%
  subset(State!="Mideast")%>%
  subset(State!="Great Lakes")%>%
  subset(State!="Plains")%>%
  subset(State!="Southeast")%>%
  subset(State!="Southwest")%>%
  subset(State!="Rocky Mountain")%>%
  subset(State!="Far West")

gdp_state$State <- state.abb[match(gdp_state$State, state.name)] #Change to state codes

homeless_population_and_gdp <- merge(homeless_and_population, gdp_state, by = "State") 

homeless_population_and_gdp <-
  homeless_population_and_gdp %>%
  mutate(GDP_per_capita = GDP*1000/`2018`)
                  

#Plotting relationship between gdp and homeless_per_capita
homeless_and_gdp_plot<-
  ggplot(homeless_population_and_gdp,
       aes(x=GDP_per_capita, y=homeless_per_100000))+
  geom_point(color=cols[2])+
  geom_smooth(color=cols[1])+
  geom_text_repel(aes(label=State), vjust = -0.5)+
  scale_y_continuous(name="Homeless every 100,000 people")+
  scale_x_continuous(name="GDP per capita (thousands USD)")+
  labs(title = "No relationship between homeless and\nGDP per capita",
       subtitle = "States with significant difference in GDP/capita may experience same level of homelessness", caption = "Source: U.S. HUD, U.S. Bureau of Economic Analysis")+
  homeless_theme

plot(homeless_and_gdp_plot)

```

##Homelessness and Resources
The Department of Housing and Urban development of the US assigns funding to the different states to support programs aiming to buid home for all their citizens. Among these programs there is the The Continuum of Care (CoC) Program, designed to promote communitywide commitment to the goal of ending homelessness.

In the following graph we will study amount of homeless in states and their allocation of resources for CoC program. As we would have expected, states with big amount of homeless receive more allocations.

```{r, message=FALSE, warning =FALSE}

#Load data of grants to CoC programs
grants <- read_excel("Data/Grantee_Awards_01272019_10472470.xlsx", sheet=1, range = "A4:G7248") 
  
grants_by_state <- grants %>%
  select(State, `Award Amount`)%>%
  group_by(State) %>%
  summarise_if(is.numeric, sum)

homeless_and_grants <- merge(grants_by_state, pit_by_state)

CA_NY_labels <- c("CA","NY")

states_over_5000 <- pit_by_state %>%
  filter(Overall.Homeless..2018> 5000) %>%
  select(State)%>%
  filter(State!="NY")%>%
  filter(State!="CA")


homeless_and_grants_plot_CA_NY<-
  ggplot(homeless_and_grants,
         aes(x=Overall.Homeless..2018, y=`Award Amount`/1000000))+
  geom_point(color=cols[2])+
  geom_smooth(color=cols[1])+
  geom_text_repel(data = homeless_and_grants[homeless_and_grants$State %in% CA_NY_labels,], aes(label=State), vjust = -0.5)+
  scale_x_continuous(name="",labels=comma)+
  scale_y_continuous(name="",labels=comma)+
  theme(axis.title.x=element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1))+
    homeless_theme

homeless_and_grants_plot_without_outliers <-
       ggplot(data = homeless_and_grants[!homeless_and_grants$State %in% CA_NY_labels,],
       aes(x=Overall.Homeless..2018, y=`Award Amount`/1000000))+
  geom_point(color=cols[2])+
  geom_smooth(color=cols[1])+
  geom_text_repel(data = homeless_and_grants[homeless_and_grants$State %in% states_over_5000$State,],aes(label=State, vjust = -0.5))+
  scale_x_continuous(name="Total homeless",labels=comma)+
  scale_y_continuous(name="Funding for Homeless Programs\n(Millions USD)",labels=comma,limit = c(0,140))+
  labs(title = "Good allocation of homeless resources in states\naccording to homeless population",subtitle = "Especially consistent with CA and NY states with highest funding and highest homeless populations", caption = "Source: U.S. HUD, U.S. Bureau of Economic Analysis")+
    homeless_theme+
  annotation_custom(grob=                     ggplotGrob(homeless_and_grants_plot_CA_NY),
                    xmin = 20000,
                    xmax = 30000,
                    ymin = 0,
                    ymax = 50)

plot(homeless_and_grants_plot_without_outliers)

```

##Studying New York City Homeless Population

As we have shown, New York State presents the highest index of homeless people per capita in the USA. Here we will present some brief more information about the homeless situation in the states capital city.

We are interested in the distribution of unsheltered homeless through different areas en New York. In addition, we would like to know the location of the different drop-in Centers,  where homeless people are provided with hot meals, showers, medical help and a place to sleep, as well as locations of Homebase (Homeless Prevention Network) offices.


```{r, results='hide', fig.keep='all', warning = F, message = F}

#DataSources
#https://data.cityofnewyork.us/Social-Services/Directory-Of-Homeless-Population-By-Year/5t4n-d72c/data
#https://data.cityofnewyork.us/Social-Services/Directory-Of-Homebase-Locations/ntcm-2w4k/data
#https://data.cityofnewyork.us/Social-Services/Directory-Of-Homeless-Drop-In-Centers/bmxf-3rd4/data
#https://www1.nyc.gov/site/planning/data-maps/open-data/dwn-nynta.page

NY_shp <- st_read("Data/NewYork/nynta_18d/nynta.shp")

homeless_ny <-read.csv("Data/NewYork/Directory_Of_Homeless_Population_By_Year.csv")[25:29,2:3]
drop_in_centers_ny <-read.csv("Data/NewYork/Directory_Of_Homeless_Drop-_In_Centers.csv")
homebase_locations_ny <-read.csv("Data/NewYork/Directory_Of_Homebase_Locations.csv") 
  
homeless_ny <- homeless_ny %>%
  separate(1,c(NA,"BoroName"), sep = "-")


homeless_ny$BoroName <- sapply(homeless_ny$BoroName, function(x)gsub("n I","n.I",x))
homeless_ny$BoroName <- sapply(homeless_ny$BoroName, function(x)gsub(" ","",x))
homeless_ny$BoroName <- sapply(homeless_ny$BoroName, function(x)gsub("n.I","n I",x))

NY_shp_with_homeless<-
  merge(NY_shp, homeless_ny[,c("BoroName","Homeless.Estimates")],by="BoroName")

NY_shp_with_homeless <- mutate(NY_shp_with_homeless, Homeless.Estimates = as.numeric(Homeless.Estimates))

world <- ne_countries(scale = "medium", returnclass = "sf")

ggplot(data=world) +
  geom_sf()+
  geom_sf(data = NY_shp_with_homeless, aes(fill=Homeless.Estimates))+
  
  annotate(geom = "label", x = -73.9, y = 40.9, label = "Bronx", 
    fontface = "italic", color = "grey22", size = 3)+
  annotate(geom = "label", x = -74, y = 40.65, label = "Brooklyn", 
    fontface = "italic", color = "grey22", size = 3)+
  annotate(geom = "label", x = -73.98, y = 40.8, label = "Manhatann", 
    fontface = "italic", color = "grey22", size = 3)+
  annotate(geom = "label", x = -73.8, y = 40.75, label = "Queens", 
    fontface = "italic", color = "grey22", size = 3)+
  annotate(geom = "label", x = -74.15, y = 40.6, label = "Staten Island", 
    fontface = "italic", color = "grey22", size = 3)+
  
  geom_point(data = homebase_locations_ny, aes(x = Longitude, y = Latitude), size = 3, shape = 23, fill = "darkred")+
  geom_point(data = drop_in_centers_ny, aes(x = Longitude, y = Latitude), size = 3, colour = "blue")+
  coord_sf(xlim = c(-74.3, -73.6), ylim = c(40.5, 40.95), expand = FALSE)+
  labs(title = "Manhattan presents low # homeless  centers\nconsidering homeless population compared to\nother areas in New York",       subtitle = "Drop in centers (blue) and Homeless Prevention Network offices (red)\nnot disrtibuted in city according to unsheltered", caption = "Source: City of New York Open Data Portal")+
  homeless_map_theme+
  scale_fill_gradientn(
    colors = cols,
    aesthetics = "fill")
```

